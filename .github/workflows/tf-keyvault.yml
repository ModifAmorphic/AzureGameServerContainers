# This is a basic workflow to help you get started with Actions

name: ùôè keyvault

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
    paths:
      - "shared/keyvault/**"
      - "!**/README.md"

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
permissions:
  id-token: write


# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  apply-terraform:
    uses: ModifAmorphic/AzureGameServerContainers/.github/workflows/~terraform-apply.yaml@features/create-tf-actions
    with:
      working-directory: shared/keyvault
      github-environment: vs-subscription

    # defaults:
    #   run:
    #     working-directory: shared/keyvault
    # env:
    #   ARM_CLIENT_ID: ${{ secrets.AZURE_OIDC_CLIENT_ID }}
    #   ARM_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
    #   ARM_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}
    #   ARM_USE_OIDC: true
    # Steps represent a sequence of tasks that will be executed as part of the job
    # steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      #- uses: actions/checkout@v3
          
      # - uses: hashicorp/setup-terraform@v3
      #   with:
      #     terraform_version: "1.5.7"
      # # - name: Azure login
      # #   uses: azure/login@v1
      # #   with:
      # #     client-id: ${{ secrets.AZURE_OIDC_CLIENT_ID }}
      # #     subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
      # #     tenant-id: ${{ secrets.AZURE_TENANT_ID }}

      # - name: Terraform Init
      #   id: init
      #   run: terraform init

      # - name: Terraform Validate
      #   id: validate
      #   run: terraform validate -no-color

      # - name: Terraform Plan
      #   id: plan
      #   run: terraform plan -no-color
      #   continue-on-error: true
      
      # - name: Terraform Apply
      #   id: apply
      #   run: terraform apply -no-color -auto-approve
